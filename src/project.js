require=function n(c,a,l){function s(t,e){if(!a[t]){if(!c[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(p)return p(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[t]={exports:{}};c[t][0].call(r.exports,function(e){return s(c[t][1][e]||e)},r,r.exports,n,c,a,l)}return a[t].exports}for(var p="function"==typeof require&&require,e=0;e<l.length;e++)s(l[e]);return s}({add_collider:[function(e,t,o){"use strict";cc._RF.push(t,"5e14d3E1d1JQ7M0cQ07e9cO","add_collider"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("./global"),i=cc._decorator,r=i.ccclass,n=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){this.tl=this.getComponent(cc.TiledLayer);for(var e=this.tl.getLayerSize(),t=this.tl.getMapTileSize(),o=0;o<e.width;o++)for(var i=0;i<e.height;i++)if(0!==this.tl.getTileGIDAt(o,i)){var r=this.addComponent(cc.BoxCollider);if(r.offset=a.GLOBAL.TM.tileToPositionAR(new cc.Vec2(o,i)),r.size=new cc.Size(t.width,t.height),cc.director.getCollisionManager().enabledDebugDraw){var n=new cc.Node,c=n.addComponent(cc.Label);c.string=o+","+i,c.fontSize=10,n.parent=cc.find("canvas"),n.position=r.offset.add(new cc.Vec2(0,-16)),n.zIndex=1}}},t.prototype.removeTileAtPosition=function(e){this.tl.removeTileAt(a.GLOBAL.TM.positionToTile(this.node.parent.convertToWorldSpaceAR(e)))},t=__decorate([r],t)}(cc.Component));o.default=n,cc._RF.pop()},{"./global":"global"}],bullet:[function(e,t,o){"use strict";cc._RF.push(t,"f9119+Uqq5Lt7phDQEBFNO9","bullet"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("./add_collider"),n=e("./player"),i=cc._decorator,c=i.ccclass,a=(i.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SPEED=800,e}return __extends(e,t),e.prototype.onLoad=function(){this.target&&(this.direction=this.target.sub(this.node.position).normalize())},e.prototype.update=function(e){var t=cc.director.getVisibleSize(),o=this.node.position;if(o.x>t.width/2||o.x<-t.width/2||o.y>t.height/2||o.y<-t.height/2)return this.node.destroy();this.target&&(this.node.position=o.add(this.direction.mul(e*this.SPEED)))},e.prototype.onCollisionEnter=function(e,t){if(0===e.tag&&this.from!==e.node&&cc.isValid(this.node)){this.node.destroy();var o=e.getComponent(r.default);o&&(o.removeTileAtPosition(e.offset),e.destroy());var i=e.getComponent(n.default);i&&(i.health-=1)}},e=__decorate([c],e)}(cc.Component));o.default=a,cc._RF.pop()},{"./add_collider":"add_collider","./player":"player"}],canvas:[function(e,t,o){"use strict";cc._RF.push(t,"9575aM3ObpPNryRs5LB5JYc","canvas"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("./global"),n=e("./player"),i=cc._decorator,c=i.ccclass,a=i.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.overlay=null,e.mainUI=null,e.mainUILoading=null,e.mainUIButtons=null,e.overlayTitle=null,e.elixirProgressBar=null,e.elixirValue=null,e.bulletValue=null,e.healthValue=null,e.playerPrefab=null,e}return __extends(e,t),e.prototype.onLoad=function(){cc.view.enableAntiAlias(!1),cc.director.getCollisionManager().enabled=!0,r.GLOBAL.CardTypes={},(r.GLOBAL.CanvasScript=this).overlay.zIndex=1,this.mainUI.zIndex=1},e.prototype.multiplayer=function(){var o=this;this.mainUILoading.active=!0,this.mainUIButtons.active=!1;var i=window.io("http://insraq.dy.fi:4000");(r.GLOBAL.Socket=i).on("spawn player",function(e){o.spawnPlayer(new cc.Vec2(e.playerX,e.playerY));var t=cc.instantiate(o.playerPrefab);t.position=r.GLOBAL.TM.tileToPositionAR(new cc.Vec2(e.enemyX,e.enemyY)),t.parent=o.node,t.getComponent(n.default).enemy=r.GLOBAL.PlayerNode,r.GLOBAL.PlayerScript.enemy=t,o.mainUI.active=!1,i.on("player move sync",function(e){t.getComponent(n.default).command(e.cardId)}),i.on("enemy left",function(){o.showOverlay("You Won!\n(Enemy Left)")})}),r.GLOBAL.Socket.emit("new player")},e.prototype.singleplayer=function(){this.spawnPlayer(new cc.Vec2(8,23));var e=cc.instantiate(this.playerPrefab),t=e.getComponent(n.default);e.position=r.GLOBAL.TM.tileToPositionAR(new cc.Vec2(8,3)),e.parent=this.node,e.getComponent(n.default).enemy=r.GLOBAL.PlayerNode,r.GLOBAL.PlayerScript.enemy=e,this.mainUI.active=!1,this.schedule(function(){if(!r.GLOBAL.Pause){var e=Math.random();e<.2?t.move("up"):e<.4?t.move("left"):e<.6?t.move("right"):e<.8?t.move("down"):e<.9&&t.health<n.default.MAX_HEALTH?t.health+=1:t.shoot()}},1,cc.macro.REPEAT_FOREVER)},e.prototype.update=function(e){r.GLOBAL.PlayerNode&&(this.elixirProgressBar.progress=r.GLOBAL.PlayerScript.elixir/n.default.MAX_ELIXIR,this.elixirValue.string=Math.floor(r.GLOBAL.PlayerScript.elixir).toString(),this.healthValue.string=r.GLOBAL.PlayerScript.health.toString(),this.bulletValue.string=r.GLOBAL.PlayerScript.bullet.toString())},e.prototype.showOverlay=function(e){r.GLOBAL.Pause=!0,this.overlay.active=!0,this.overlayTitle.string=e},e.prototype.hideOverlay=function(){r.GLOBAL.Pause=!1,this.overlay.active=!1},e.prototype.restart=function(){r.GLOBAL.Pause=!1,cc.director.loadScene(cc.director.getScene().name)},e.prototype.spawnPlayer=function(e){r.GLOBAL.PlayerNode=cc.instantiate(this.playerPrefab),r.GLOBAL.PlayerScript=r.GLOBAL.PlayerNode.getComponent(n.default),r.GLOBAL.PlayerNode.position=r.GLOBAL.TM.tileToPositionAR(e),r.GLOBAL.PlayerScript.isPlayer=!0,r.GLOBAL.PlayerNode.parent=this.node},__decorate([a(cc.Node)],e.prototype,"overlay",void 0),__decorate([a(cc.Node)],e.prototype,"mainUI",void 0),__decorate([a(cc.Node)],e.prototype,"mainUILoading",void 0),__decorate([a(cc.Node)],e.prototype,"mainUIButtons",void 0),__decorate([a(cc.Label)],e.prototype,"overlayTitle",void 0),__decorate([a(cc.ProgressBar)],e.prototype,"elixirProgressBar",void 0),__decorate([a(cc.Label)],e.prototype,"elixirValue",void 0),__decorate([a(cc.Label)],e.prototype,"bulletValue",void 0),__decorate([a(cc.Label)],e.prototype,"healthValue",void 0),__decorate([a(cc.Prefab)],e.prototype,"playerPrefab",void 0),e=__decorate([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./global":"global","./player":"player"}],card:[function(e,t,i){"use strict";cc._RF.push(t,"942448n3ONNwrfxrd0XnHxW","card"),Object.defineProperty(i,"__esModule",{value:!0});var r=e("./global"),o=cc._decorator,n=o.ccclass,c=o.property,a={cardName:"Aim and Shoot".toUpperCase(),elixir:3,bullet:1,type:"shoot",action:function(e){e.shoot()}};i.CARDS=[a,a,a,a,{cardName:"Up +1".toUpperCase(),elixir:1,bullet:0,type:"up",action:function(e){e.move("up")}},{cardName:"Left +1".toUpperCase(),elixir:1,bullet:0,type:"left",action:function(e){e.move("left")}},{cardName:"Right +1".toUpperCase(),elixir:1,bullet:0,type:"right",action:function(e){e.move("right")}},{cardName:"Down +1".toUpperCase(),elixir:1,bullet:0,type:"down",action:function(e){e.move("down")}},{cardName:"Up +3".toUpperCase(),elixir:2,bullet:0,type:"up",action:function(e){e.move("up"),e.move("up"),e.move("up")}},{cardName:"Left +3".toUpperCase(),elixir:2,bullet:0,type:"left",action:function(e){e.move("left"),e.move("left"),e.move("left")}},{cardName:"Right +3".toUpperCase(),elixir:2,bullet:0,type:"right",action:function(e){e.move("right"),e.move("right"),e.move("right")}},{cardName:"Down +3".toUpperCase(),elixir:2,bullet:0,type:"down",action:function(e){e.move("down"),e.move("down"),e.move("down")}},{cardName:"Bullet +2".toUpperCase(),elixir:2,bullet:0,type:"bullet",action:function(e){e.bullet+=2}},{cardName:"Health +1".toUpperCase(),elixir:2,bullet:0,type:"health",action:function(e){e.health+=1}}];var l=function(e){for(var t=e.length-1;0<t;t--){var o=Math.floor(Math.random()*(t+1));i=[e[o],e[t]],e[t]=i[0],e[o]=i[1]}return e;var i}(i.CARDS.slice(0)),s=0,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardName=null,e.elixir=null,e}return __extends(e,t),e.prototype.onLoad=function(){this._initialPosition=this.node.position,this._initialElixirColor=this.elixir.node.color,this._initialNameColor=this.cardName.node.color,this.drawCard()},e.prototype.onClick=function(e){var t=this;if(this._canBeUsed()){r.GLOBAL.PlayerScript.elixir=r.GLOBAL.PlayerScript.elixir-this.currentCard().elixir;var o=i.CARDS.indexOf(this.currentCard());r.GLOBAL.Socket&&r.GLOBAL.Socket.emit("player move",{cardId:o}),r.GLOBAL.PlayerScript.command(o),r.GLOBAL.CardTypes[this.currentCard().type]--,this.node.runAction(cc.sequence(cc.spawn(cc.moveBy(.25,0,300),cc.scaleTo(.25,1.25,1.25),cc.fadeOut(.25)),cc.callFunc(function(){t.drawCard()}),cc.place(this._initialPosition),cc.delayTime(1),cc.spawn(cc.scaleTo(.25,1,1),cc.fadeIn(.25))))}},e.prototype.update=function(e){this._canBeUsed()?(this.cardName.node.color=this._initialNameColor,this.elixir.node.color=this._initialElixirColor):(this.cardName.node.color=new cc.Color(150,150,150),this.elixir.node.color=new cc.Color(150,150,150))},e.prototype._canBeUsed=function(){return r.GLOBAL.PlayerScript&&r.GLOBAL.PlayerScript.elixir>=this.currentCard().elixir&&r.GLOBAL.PlayerScript.bullet>=this.currentCard().bullet},e.prototype.drawCard=function(){for(;;){var e=l[++s%l.length];if(!r.GLOBAL.CardTypes[e.type])return this._currentCard=e,this.cardName.string=this._currentCard.cardName,this.elixir.string=this._currentCard.elixir.toString(),void(r.GLOBAL.CardTypes[e.type]=1)}},e.prototype.currentCard=function(){return this._currentCard},__decorate([c(cc.Label)],e.prototype,"cardName",void 0),__decorate([c(cc.Label)],e.prototype,"elixir",void 0),e=__decorate([n],e)}(cc.Component);i.default=p,cc._RF.pop()},{"./global":"global"}],global:[function(e,t,o){"use strict";cc._RF.push(t,"afee5nfPnxFnY58k8UHsitI","global"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function e(e,t){this.tileSize=e,this.layerSize=t}return e.prototype.tileToPositionAR=function(e){return new cc.Vec2(this.tileSize.width*(e.x+.5-this.layerSize.width/2),(this.layerSize.height/2-e.y-.5)*this.tileSize.height)},e.prototype.positionToTile=function(e){return new cc.Vec2(Math.floor(e.x/this.tileSize.width),this.layerSize.height-1-Math.floor(e.y/this.tileSize.height))},e}(),r={PlayerNode:null,PlayerScript:null,CanvasScript:null,Pause:!1,TM:new(o.TileMapCalc=i)(new cc.Size(32,32),new cc.Size(18,32)),Socket:null,CardTypes:{}};o.GLOBAL=r,cc._RF.pop()},{}],player:[function(e,t,o){"use strict";cc._RF.push(t,"e1b90/rohdEk4SdmmEZANaD","player"),Object.defineProperty(o,"__esModule",{value:!0});var r=e("./add_collider"),i=e("./bullet"),n=e("./card"),c=e("./global"),a=cc._decorator,l=a.ccclass,s=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enemy=null,e.isPlayer=!1,e.bulletPrefab=null,e.heathProgressBar=null,e.enemySpriteFrame=null,e._elixir=5,e._overlap={},e._moveQueue=[],e._moving=!1,e}return __extends(e,t),o=e,Object.defineProperty(e.prototype,"bullet",{get:function(){return this._bullet},set:function(e){this._bullet=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"health",{get:function(){return this._health},set:function(e){e>o.MAX_HEALTH||(e===this._health-1&&(this.node.runAction(cc.sequence(cc.blink(1,5),cc.fadeIn(.25))),this.playSound(this.isPlayer?"hurt":"hit")),e>this._health&&this.node.runAction(cc.sequence(cc.scaleTo(.25,1.5,1.5),cc.scaleTo(.25,1,1))),e<=0?c.GLOBAL.CanvasScript.showOverlay(this.isPlayer?"You Lost!":"You Won!"):(this.heathProgressBar.progress=e/o.MAX_HEALTH,this._health=e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elixir",{get:function(){return this._elixir},set:function(e){this._elixir=e},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.size=this.node.getContentSize().width,this.health=o.MAX_HEALTH,this.bullet=5,this.health=5,this.isPlayer||(this.getComponent(cc.Sprite).spriteFrame=this.enemySpriteFrame),this.isPlayer&&cc.director.getCollisionManager().enabledDebugDraw&&cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},e.prototype.onDestroy=function(){this.isPlayer&&cc.director.getCollisionManager().enabledDebugDraw&&cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},e.prototype.playSound=function(e){for(var t=0,o=this.getComponents(cc.AudioSource);t<o.length;t++){var i=o[t];if(-1!==String(i.clip).indexOf(e))return void i.play()}},e.prototype.command=function(e){n.CARDS[e].action(this)},e.prototype.move=function(e){this._moveQueue.push(e)},e.prototype.update=function(e){c.GLOBAL.Pause||(this.elixir<=o.MAX_ELIXIR&&(this.elixir+=e),this._processMove())},e.prototype.shoot=function(){if(!(this.bullet<=0)){this.bullet--;var e=cc.instantiate(this.bulletPrefab);e.getComponent(i.default).target=this.enemy.position,e.getComponent(i.default).from=this.node,e.position=this.node.position,e.parent=this.node.parent,this.playSound("shoot")}},e.prototype.onCollisionEnter=function(e,t){if(1===t.tag&&e.getComponent(r.default)){var o=e.world.aabb,i=c.GLOBAL.TM.positionToTile(new cc.Vec2(o.x,o.y));this._overlap[i.toString()]=!0}},e.prototype.onCollisionExit=function(e,t){if(1===t.tag&&e.getComponent(r.default)){var o=e.world.aabb,i=c.GLOBAL.TM.positionToTile(new cc.Vec2(o.x,o.y));delete this._overlap[i.toString()]}},e.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.KEY.w:this.move("up");break;case cc.KEY.a:this.move("left");break;case cc.KEY.s:this.move("down");break;case cc.KEY.d:this.move("right");break;case cc.KEY.space:this.shoot()}},e.prototype._processMove=function(){var e=this;if(!this._moving&&0!==this._moveQueue.length){this._moving=!0;this.node.position;var t,o=this._moveQueue.shift(),i=c.GLOBAL.TM.positionToTile(this.node.parent.convertToWorldSpaceAR(this.node.position));switch(o){case"up":t=new cc.Vec2(i.x,i.y-1);break;case"down":t=new cc.Vec2(i.x,i.y+1);break;case"right":t=new cc.Vec2(i.x+1,i.y);break;case"left":t=new cc.Vec2(i.x-1,i.y)}t&&!this._overlap[t.toString()]?this.node.runAction(cc.sequence(cc.moveTo(.25,c.GLOBAL.TM.tileToPositionAR(t)),cc.callFunc(function(){e._moving=!1}))):this._moving=!1}},e.MAX_ELIXIR=10,e.MAX_HEALTH=5,__decorate([s(cc.Prefab)],e.prototype,"bulletPrefab",void 0),__decorate([s(cc.ProgressBar)],e.prototype,"heathProgressBar",void 0),__decorate([s(cc.SpriteFrame)],e.prototype,"enemySpriteFrame",void 0),e=o=__decorate([l],e);var o}(cc.Component);o.default=p,cc._RF.pop()},{"./add_collider":"add_collider","./bullet":"bullet","./card":"card","./global":"global"}],"socket.io.d":[function(e,t,o){"use strict";cc._RF.push(t,"5253bGA6cJKCrT8kMO9xBVx","socket.io.d"),cc._RF.pop()},{}]},{},["socket.io.d","add_collider","bullet","canvas","card","global","player"]);